<?php
/*
	Класс таблицы People
*/

class People extends CActiveRecord
{
    public static function model($className=__CLASS__)
    {
        return parent::model($className);
    }
 
    public function tableName()
    {
        return 'people';
    }
    
    /*
    	Описаны отношения с другими таблицами БД
    */
    public function relations() 
    {
		return array(
			'people_group'=>array(self::BELONGS_TO, 'PeopleGroup', 'pgroup_id'),
			'my_packages'=>array(self::HAS_MANY, 'Package', 'manager_id'),
			'packages'=>array(self::HAS_MANY, 'Package', 'client_id', 'order'=>'dt_beg DESC')
			);
	}
    
    /*
    	Возвращает человека по его ID
    */
    public static function getById($id)
    {
    	$people = self::model()->find(array('condition'=>"id=$id", 'limit'=>1));
    	
    	//return $people->getAttributes();
    	return $people;
    }
    
    /*
    	Возвращает список всех людей (вне зависимости от роли)
    */
    public static function getAll()
    {
    	$people = self::model()->findAll();
    	return $people;
    }
    
    /*
		Выводим (!) (знаю, что криво, но пока так) список мастеров.
		В параметре можно передать ID выбранного мастера
	*/
	public function GetMasters( $sel = -1 )
	{
		$peoples = PeopleGroup::getById( 5 )->peoples;
		foreach ( $peoples as $people )
		{
			$selected = '';
			if ( $people->id == $sel ) $selected = ' selected';
			
			print "<option value='".$people->id."' $selected>";
			print $people->fio;
			print "</option>\n";
		}
	}

    
}
?>